ubuntu@host-10-0-1-113:~$ #!/bin/bash

# WAS 서버의 내부 IP 주소를 환경 변수로 지정하세요.
WAS_IP="10.0.2.10"    # 실제 WAS VM의 내부 IP로 수정

# 1. Nginx 설치
sudo apt-get update
sudo apt-get install -y nginx

# 2. Nginx 기본 설정 백업
sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak

# 3. Nginx 프록시 설정 (모든 요청을 WAS로 전달)
sudo tee /etc/nginx/sites-available/default > /dev/null <<EOF
server {
    listen 80 default_server;
    listen [::]:80 default_server;

    server_name _;

    location / {
        proxy_pass http://$WAS_IP:8080;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
    }
}
echo "Nginx가 $WAS_IP:8080으로 프록시하도록 설정되었습니다."
Get:1 http://security.ubuntu.com/ubuntu noble-security InRelease [126 kB]
Hit:2 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble InRelease
Get:3 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates InRelease [126 kB]
Get:4 http://security.ubuntu.com/ubuntu noble-security/main amd64 Packages [920 kB]
Get:5 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports InRelease [126 kB]
Get:6 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble/universe amd64 Packages [15.0 MB]
Get:7 http://security.ubuntu.com/ubuntu noble-security/main Translation-en [169 kB]
Get:8 http://security.ubuntu.com/ubuntu noble-security/main amd64 Components [21.5 kB]
Get:9 http://security.ubuntu.com/ubuntu noble-security/main amd64 c-n-f Metadata [7068 B]
Get:10 http://security.ubuntu.com/ubuntu noble-security/universe amd64 Packages [863 kB]
Get:11 http://security.ubuntu.com/ubuntu noble-security/universe Translation-en [189 kB]
Get:12 http://security.ubuntu.com/ubuntu noble-security/universe amd64 Components [52.3 kB]
Get:13 http://security.ubuntu.com/ubuntu noble-security/universe amd64 c-n-f Metadata [17.0 kB]
Get:14 http://security.ubuntu.com/ubuntu noble-security/restricted amd64 Packages [1235 kB]
Get:15 http://security.ubuntu.com/ubuntu noble-security/restricted Translation-en [263 kB]
Get:16 http://security.ubuntu.com/ubuntu noble-security/restricted amd64 Components [212 B]
Get:17 http://security.ubuntu.com/ubuntu noble-security/restricted amd64 c-n-f Metadata [468 B]
Get:18 http://security.ubuntu.com/ubuntu noble-security/multiverse amd64 Packages [17.7 kB]
Get:19 http://security.ubuntu.com/ubuntu noble-security/multiverse Translation-en [3792 B]
Get:20 http://security.ubuntu.com/ubuntu noble-security/multiverse amd64 Components [212 B]
Get:21 http://security.ubuntu.com/ubuntu noble-security/multiverse amd64 c-n-f Metadata [380 B]
Get:22 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble/universe Translation-en [5982 kB]
Get:23 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble/universe amd64 Components [3871 kB]
Get:24 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble/universe amd64 c-n-f Metadata [301 kB]
Get:25 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble/multiverse amd64 Packages [269 kB]
Get:26 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble/multiverse Translation-en [118 kB]
Get:27 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble/multiverse amd64 Components [35.0 kB]
Get:28 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble/multiverse amd64 c-n-f Metadata [8328 B]
Get:29 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/main amd64 Packages [1198 kB]
Get:30 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/main Translation-en [247 kB]
Get:31 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/main amd64 Components [161 kB]
Get:32 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/main amd64 c-n-f Metadata [13.5 kB]
Get:33 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/universe amd64 Packages [1096 kB]
Get:34 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/universe Translation-en [278 kB]
Get:35 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/universe amd64 Components [376 kB]
Get:36 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/universe amd64 c-n-f Metadata [26.0 kB]
Get:37 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/restricted amd64 Packages [1358 kB]
Get:38 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/restricted Translation-en [291 kB]
Get:39 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/restricted amd64 Components [212 B]
Get:40 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/restricted amd64 c-n-f Metadata [492 B]
Get:41 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/multiverse amd64 Packages [22.1 kB]
Get:42 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/multiverse Translation-en [4972 B]
Get:43 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/multiverse amd64 Components [940 B]
Get:44 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/multiverse amd64 c-n-f Metadata [592 B]
Get:45 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports/main amd64 Packages [39.2 kB]
Get:46 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports/main Translation-en [8676 B]
Get:47 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports/main amd64 Components [7076 B]
Get:48 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports/main amd64 c-n-f Metadata [272 B]
Get:49 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports/universe amd64 Packages [27.1 kB]
Get:50 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports/universe Translation-en [16.5 kB]
Get:51 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports/universe amd64 Components [16.3 kB]
Get:52 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports/universe amd64 c-n-f Metadata [1304 B]
Get:53 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports/restricted amd64 Components [216 B]
Get:54 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports/restricted amd64 c-n-f Metadata [116 B]
Get:55 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports/multiverse amd64 Components [212 B]
Get:56 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-backports/multiverse amd64 c-n-f Metadata [116 B]
Fetched 35.0 MB in 35s (1010 kB/s)
Reading package lists... Done
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  nginx-common
Suggested packages:
  fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  nginx nginx-common
0 upgraded, 2 newly installed, 0 to remove and 287 not upgraded.
Need to get 564 kB of archives.
After this operation, 1596 kB of additional disk space will be used.
Get:1 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/main amd64 nginx-common all 1.24.0-2ubuntu7.4 [43.4 kB]
Get:2 http://kr-central-2-a.clouds.archive.ubuntu.com/ubuntu noble-updates/main amd64 nginx amd64 1.24.0-2ubuntu7.4 [521 kB]
Fetched 564 kB in 4s (148 kB/s)
Preconfiguring packages ...
Selecting previously unselected package nginx-common.
(Reading database ... 71864 files and directories currently installed.)
Preparing to unpack .../nginx-common_1.24.0-2ubuntu7.4_all.deb ...
Unpacking nginx-common (1.24.0-2ubuntu7.4) ...
Selecting previously unselected package nginx.
Preparing to unpack .../nginx_1.24.0-2ubuntu7.4_amd64.deb ...
Unpacking nginx (1.24.0-2ubuntu7.4) ...
Setting up nginx-common (1.24.0-2ubuntu7.4) ...
Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /usr/lib/systemd/system/nginx.service.
Setting up nginx (1.24.0-2ubuntu7.4) ...
 * Upgrading binary nginx                                                                                                                                                    [ OK ]
Processing triggers for man-db (2.12.0-4build2) ...
Processing triggers for ufw (0.36.2-6) ...
Scanning processes...
Scanning linux images...

Running kernel seems to be up-to-date.

No services need to be restarted.

No containers need to be restarted.

No user sessions are running outdated binaries.

No VM guests are running outdated hypervisor (qemu) binaries on this host.
Nginx가 10.0.2.10:8080으로 프록시하도록 설정되었습니다.
